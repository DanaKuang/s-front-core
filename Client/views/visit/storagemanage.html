<!--
/**
 * Author: hanzha
 * Create Date; 2017-12-18 重构零售户
 * Description: 扫码入库奖励管理
 */
-->
<link rel="stylesheet" href="statics/assets/style/questionnaire.css">
<link rel="stylesheet" href="statics/assets/style/form.css">
<!--分页样式-->
<link rel="stylesheet" href="statics/assets/style/pagination.css">
<link rel="stylesheet" href="statics/assets/style/visit.storagemanage.css"/>

<div ng-controller="visitStorageManageCtrl">
    <div class="animated fadeInRightBig">
        <div class="container-fluid">
            <div class="row ui-manage-box">
                <div class="col-md-12">
                    <!--title-->
                    <div class="ui-panel-title storagemanage">
                        <div><span>扫码入库奖励管理</span></div>
                    </div>

                    <div class="panel rate" id="manage-tap">
                        <div class="panel-body ui-manage-panel" id="panel-body">

                            <div class="tab-content">
                                <!-- 搜索条件 -->
                                <div ng-show="vm.currentPage == 'index'" role="tabpanel" class="tab-pane active panel-body">
                                    <form class="form-horizontal form-inline">
                                        <div class="form-group col-sm-4">
                                            <label for="brand" class="control-label">品牌：</label>
                                            <div class="col-sm-8">
                                                <select ng-change="brandChage()" ng-model="vm.brand" id="brand" class="form-control select" multiple>
                                                    <option value="">全部</option>
                                                    <option ng-repeat="item in brandList" value="{{item.brandCode}}">{{item.name}}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group col-sm-4">
                                            <label for="spec" class="control-label">规格：</label>
                                            <div class="col-sm-8">
                                                <select ng-model="vm.spec" id="spec" class="form-control select" multiple>
                                                    <option value="">全部</option>
                                                    <option ng-repeat="item in specList" value="{{item.sn}}">{{item.name}}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group col-sm-4">
                                            <label for="actStatus" class="control-label">状态：</label>
                                            <div class="col-sm-8">
                                                <select ng-model="vm.actStatus" id="actStatus" class="form-control">
                                                    <option value="">全部</option>
                                                    <option ng-repeat="item in actStatusList" value="{{item.code}}">{{item.name}}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group col-sm-4">
                                            <label for="actType" class="control-label">奖品类型：</label>
                                            <div class="col-sm-8">
                                                <select ng-model="vm.actType" id="actType" class="form-control">
                                                    <option value="">全部</option>
                                                    <option ng-repeat="item in actTypeList" value="{{item.code}}">{{item.name}}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group time">
                                            <label class="control-label">创建时间：</label>

                                            <div class="col-sm-9">
                                                <input ng-model="vm.startTime" id="durationStart" class="form_datetime dateTime form-control" readonly placeholder="开始时间">
                                                <span class="to">至</span>
                                                <input ng-model="vm.endTime" id="durationEnd" class="form_datetime dateTime form-control" readonly placeholder="结束时间">
                                            </div>
                                        </div>

                                        <div class="form-group search-btn-con">
                                            <button type="button" class="search btn btn-primary" ng-click="search($event);">查询</button>
                                            <button type="button" class="reset btn btn-default" ng-click="reset($event);">重置</button>
                                        </div>
                                    </form>
                                </div>


                                <div class="panel-body scroll-con">
                                    <!-- table -->
                                    <table ng-show="vm.currentPage == 'index'" class="table table-bordered table-hover">
                                        <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>操作</th>
                                            <th>品牌</th>
                                            <th>规格</th>
                                            <th>奖品类型</th>

                                            <th>扫码奖励／条</th>
                                            <th>奖品数量</th>
                                            <th>奖品剩余数量</th>
                                            <th>有效时间</th>
                                            <th>创建时间</th>

                                            <th>状态</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="(index, item) in vm.listData">
                                            <td class="batch">
                                                <label>{{index + 1}}</label>
                                            </td>
                                            <td>
                                                <div class="oper-btn-wrap">
                                                    <div class="operate-btn" ng-click="viewStorage(item.id, item.awardType)">查看详情</div>
                                                    <div class="operate-btn" ng-click="newAndEditStorage(item.id, 'edit')">修改</div>
                                                    <div class="operate-btn" ng-if="item.status == 0" ng-click="setEnabled(item.id, 1)" data-toggle="modal" data-target=".storage-modal">启用</div>
                                                    <div class="operate-btn" ng-if="item.status == 1" ng-click="setEnabled(item.id, 0)" data-toggle="modal" data-target=".storage-modal">禁用</div>
                                                </div>
                                            </td>
                                            <td>{{item.brandName}}</td>
                                            <td>{{item.snName}}</td>
                                            <td>{{item.awardTypeName}}</td>

                                            <td>{{item.awardName}}</td>
                                            <td>{{item.totalNum}}份</td>
                                            <td>{{item.totalNum - item.usedNum}}份</td>
                                            <td>
                                                <div class="time">
                                                    {{item.stime | date:'yyyy-MM-dd HH:mm:ss'}}
                                                    <div>-</div>
                                                    {{item.etime | date:'yyyy-MM-dd HH:mm:ss'}}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="ctime">
                                                    {{item.ctime | date:'yyyy-MM-dd HH:mm:ss'}}
                                                </div>
                                            </td>

                                            <td>{{item.status == 0 ? '停用' : '启用'}}</td>
                                        </tr>
                                        </tbody>
                                    </table>

                                    <!-- 详情 -->
                                    <div ng-show="vm.currentPage == 'detial'">
                                        <div class="detial-head">
                                            <p class="col-sm-3"><span>品牌：</span>{{detial.brandName}}</p>
                                            <p class="col-sm-3"><span>规格：</span>{{detial.snName}}</p>
                                            <p class="col-sm-3"><span>奖励类型：</span>{{detial.awardType}}</p>
                                            <p class="col-sm-3"><span>状态：</span><td>{{detial.status == 0 ? '停用' : '启用'}}</td></p>
                                            <p class="col-sm-6"><span>有效时间：</span>{{detial.stimeStr}} - - {{detial.etimeStr}}</p>
                                            <p class="col-sm-3"><span>创建时间：</span>{{detial.ctime | date:'yyyy-MM-dd HH:mm:ss'}}</p>
                                            <p class="col-sm-3"><span>扫码奖励/条：</span>{{detial.awardName}}</p>
                                            <p class="col-sm-3"><span>奖品数量：</span>{{detial.totalNum}}</p>
                                            <p class="col-sm-3"><span>奖品剩余数量：</span>{{detial.totalNum - detial.usedNum}}</p>
                                        </div>

                                        <!-- 搜索项 -->
                                        <div class="detial-search">
                                            <!-- 账单流水 搜索项 -->
                                            <div class="form-group col-sm-3">
                                                <label class="control-label">关键词：</label>
                                                <input ng-model="detial.shopName" class="form-control" placeholder="请输入门店名称" type="text">
                                            </div>

                                            <!-- 日历 -->
                                            <div class="form-group time col-sm-6">
                                                <label class="control-label">时间段：</label>
                                                <input ng-model="detial.startTime" id="detialStart" class="form_datetime dateTime form-control" readonly placeholder="开始时间">
                                                <span class="to">至</span>
                                                <input ng-model="detial.endTime" id="detialEnd" class="form_datetime dateTime form-control" readonly placeholder="结束时间">
                                            </div>

                                            <!-- 搜索、重置 -->
                                            <div class="btn-con col-sm-3">
                                                <button type="button" class="seacher btn btn-primary" ng-click="detial.search();">查询</button>
                                                <button type="button" class="reset btn btn-default" ng-click="detial.reset();">重置</button>
                                            </div>
                                        </div>

                                        <div class="sort-btn-con">
                                            <button ng-click="detial.sortBy('ssia.ctime')" class="btn btn-primary">按扫码入库时间排序</button>
                                            <button ng-click="detial.sortBy('ssia.num')" class="btn btn-primary">按扫码入库数量排序</button>
                                        </div>

                                        <table class="table table-bordered table-hover">
                                            <thead>
                                            <tr>
                                                <th>序号</th>
                                                <th>操作</th>
                                                <th>门店名称</th>
                                                <th>联系人姓名</th>
                                                <th>门店地址</th>

                                                <th>扫码数量</th>
                                                <th>扫码入库时间</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr ng-repeat="(index, item) in detial.listData">
                                                <td>{{index+1}}</td>
                                                <td>
                                                    <div class="oper-btn-wrap">
                                                        <div class="operate-btn" ng-click="detial.view(item.sellerId, item.settingId, item.awardType)">查看详情</div>
                                                    </div>
                                                </td>
                                                <td>{{item.shopName}}</td>
                                                <td>{{item.ownerName}}</td>
                                                <td>{{item.addrDetail}}</td>

                                                <td>{{item.batch}}</td>
                                                <td>{{item.ctime | date:'yyyy-MM-dd HH:mm:ss'}}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="total-page">总共{{totalCount}}条记录<span ng-if="totalCount != 0">，当前页共{{size}}条记录</span></div>
                                </div>
                            </div>

                            <!-- 分页区 -->
                            <div class="pagination-wrap">
                                <!-- 分页指令 -->
                                <sa-pagination id="pagination" conf="paginationConf" curPage="currentPageNumber" class="pagination"></sa-pagination>
                            </div>

                            <button ng-show="vm.currentPage == 'detial'" ng-click="detial.back()" class="btn btn-primary back-btn">返回列表</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- 提示框 -->
    <div id="newAlert" class="alert alert-dismissible fade" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>
        <p class="prompt"></p>
    </div>

    <!-- 比例 -->
    <div class="modal fade bs-example-modal-sm storage-modal" tabindex="-1" role="dialog" aria-labelledby="passTitle">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header"><p id="passTitle"><span ng-if="vm.isEnabled">启用：</span><span ng-if="!vm.isEnabled">禁用：</span></p><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div>
                <form name="storageForm" novalidate>
                    <div class="modal-body">
                        您确认要<span ng-if="vm.isEnabled">启用</span><span ng-if="!vm.isEnabled">禁用</span>此商品的扫码入库奖励?
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" ng-click="enabledConfirm()">确定</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <script src="statics/assets/libs/jquery.page.js"></script>
    <script src="statics/assets/libs/jqmeter.min.js"></script>
</div>